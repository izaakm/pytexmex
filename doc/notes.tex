\documentclass[10pt]{article}

\usepackage{amsmath,amssymb}

\begin{document}

\title{the math of texmex}
\author{Scott Olesen}

\maketitle

The Poisson-lognormal pmf is a convolution of the Poisson pmf with the lognormal pdf:
\begin{align}
    \mathrm{Poilog}(n; \mu, \sigma) &= \int_0^\infty \mathrm{Poisson}(n; \lambda) \times \mathrm{Lognormal}(\lambda; \mu, \sigma) \,\mathrm{d}\lambda \\
    &= \int_0^\infty \frac{\lambda^n e^{-\lambda}}{n!} \times \frac{1}{\lambda \sigma \sqrt{2 \pi}} \exp \left\{ -\frac{(\ln \lambda - \mu)^2}{2 \sigma^2} \right\} \,\mathrm{d}\lambda \\
    &= \frac{1}{n! \, \sigma \sqrt{2\pi}} \int_{-\infty}^\infty \exp \left\{ nx - e^x - \frac{1}{2} \left(\frac{x - \mu}{\sigma}\right)^2 \right\} \,\mathrm{d}x,
\end{align}
where $x = \ln \lambda$.

This integral presents a few challenges:
\begin{itemize}
\item When $n$ is large, $n!$ becomes difficult to compute.
\item When $x$ is large, the double exponential leads to overflows.
\end{itemize}
I got around these problems by:
\begin{itemize}
\item computing $\log n!$, i.e., $\log \Gamma(n + 1)$, which tends to be tractable, and put that
inside the integrand, and
\item being smart about the bounds of the integral.
\end{itemize}
Specifically, I examine the three terms inside the integral:
\begin{equation}
    f(x) \equiv nx - e^x - \frac{1}{2} \left(\frac{x - \mu}{\sigma}\right)^2
\end{equation}
It is easy to numerically compute the $x^\star$ that maximizes $f$. To find the lower bound, I establish
some threshold $T$ (say, $10^{-10}$) and iterate:
\begin{enumerate}
\item Guess a difference $\Delta x$, say $1.0$.
\item If $f(x^\star - \Delta x) / f(x^\star) < T$, then the lower bound $x^\star - \Delta x$ is far away
enough from $x^\star$ that integrating down to that point will capture most of the value of the integral.
\item If the ratio does not reach down to the threshold $T$, multiply $\Delta x$ by some factor, say $2.0$,
and try again.
\end{enumerate}
To find the upper bound, repeat but with $x^\star + \Delta x$.

\end{document}
